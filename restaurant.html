<!DOCTYPE html>
<html>

<head>
  <!-- Normalize.css for better cross-browser consistency -->
  <link rel="stylesheet" src="//normalize-css.googlecode.com/svn/trunk/normalize.css" />
  <!-- Main CSS file -->
  <link rel="stylesheet" href="css/styles.css" type="text/css">
  <title>Restaurant Info</title>
</head>

<body class="inside">
  <!-- Beginning header -->
  <header>
    <!-- Beginning nav -->
    <nav>
      <h1><a href="/">Restaurant Reviews</a></h1>
    </nav>
    <!-- Beginning breadcrumb -->
    <ul id="breadcrumb" >
      <li><a href="/">Home</a></li>
    </ul>
    <!-- End breadcrumb -->
    <!-- End nav -->
  </header>
  <!-- End header -->

  <!-- Beginning main -->
  <main id="maincontent">
    <!-- Beginning map -->
    <section id="map-container" class="map-hidden">
      <div role='dialog' class="address-dialog" labelledBy='restaurant address'>
        <div id="map"></div>
        <button class="close-button">Close</button>
      </div>
    </section>
    <!-- End map -->
    <!-- Beginning restaurant -->
    <section id="restaurant-container">
      <h1 id="restaurant-name"></h1>
      <img id="restaurant-img">
      <p id="restaurant-cuisine"></p>
      <p id="restaurant-address"></p>
      <table id="restaurant-hours"></table>
      <button onclick="displayRestoLocation()">View address</button>
    </section>
    <!-- end restaurant -->
    <!-- Beginning reviews -->
    <section id="reviews-container">
      <ul id="reviews-list"></ul>
    </section>
    <!-- End reviews -->
  </main>
  <!-- End main -->

  <!-- Beginning footer -->
  <footer id="footer">
    Copyright (c) 2017 <a href="/"><strong>Restaurant Reviews</strong></a> All Rights Reserved.
  </footer>
  <!-- End footer -->

  <!-- Beginning scripts -->
  <!-- Database helpers -->
  <script type="text/javascript" src="js/dbhelper.js"></script>
  <!-- Main javascript file -->
  <script type="text/javascript" src="js/restaurant_info.js"></script>
  <!-- Google Maps -->
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBqeCAur3WuwLz9vaZyfuVA4WzfqSFjmiM&libraries=places&callback=initMap"></script>

  <script type="text/javascript">
    let modalOverlay = document.querySelector('#map-container');
    let focusedElementBeforeModal;
    let modal = document.querySelector('.address-dialog');
    let firstTabStop;
    let lastTabStop;
    let closeButton = document.querySelector('.close-button');

    displayRestoLocation = () => {
      focusedElementBeforeModal = document.activeElement;

      // Listen for and trap the keyboard
      modal.addEventListener('keydown', trapTabKey);

      // prevent modal to close when click on the map
      modal.addEventListener('click', (e) => {
        e.stopPropagation();
      })

      modalOverlay.addEventListener('click', closeModal);
      closeButton.addEventListener('click', closeModal);

      // Find all focusable children
      var focusableElementsString = 'a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, [tabindex="0"], [contenteditable]';
      var focusableElements = [...modal.querySelectorAll(focusableElementsString)];

      firstTabStop = focusableElements[0];
      lastTabStop = focusableElements[focusableElements.length - 1];

      document.querySelector('#map-container')
      .classList.remove('map-hidden');

      // Focus first child
      firstTabStop.focus();
    }

    trapTabKey = (e) => {
       // Check for TAB key press
    if (e.keyCode === 9) {

      // SHIFT + TAB
      if (e.shiftKey) {
        if (document.activeElement === firstTabStop) {
          e.preventDefault();
          lastTabStop.focus();
        }

      // TAB
      } else {
        if (document.activeElement === lastTabStop) {
          e.preventDefault();
          firstTabStop.focus();
        }
      }
    }

    // ESCAPE
    if (e.keyCode === 27) {
      closeModal();
    }
  }

    closeModal = () => {
     document.querySelector('#map-container')
      .classList.add('map-hidden'); 

      // Set focus back to element that had it before the modal was opened
      focusedElementBeforeModal.focus();
    }
  </script>
  <!-- End scripts -->

</body>

</html>
